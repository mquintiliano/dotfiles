{{/* Install Nerd Fonts */}}
{{- if (and (eq .chezmoi.os "linux") (not .headless) (ne .chezmoi.username "root")) -}}

#!/bin/bash

set -eufo pipefail

# List of Nerd Fonts font to install
nerdfonts_font=(FiraCode)

font_dir=~/.local/share/fonts

# renovate: depName=ryanoasis/nerd-fonts datasource=github-releases
nerdfonts_current_version=v3.1.1
nerdfonts_download_url=https://github.com/ryanoasis/nerd-fonts/releases/download

updated_counter=0
for font in ${nerdfonts_fonts[@]}; do
  if $(fc-list | grep -i "$font Nerd Font" &> /dev/null); then
    echo "$font is already installed"
  else
    echo "installing $font"
    mkdir -p $font_dir/$font
    curl -fLo $font_dir/$font.zip $nerdfonts_download_url/$nerdfonts_current_version/$font.zip && unzip -o "$font_dir/$font.zip" -d $font_dir/$font && rm $font_dir/$font.zip
    updated_counter=$((updated_counter + 1))
  fi
done

# reset font cache
if [ $updated_counter -gt 0 ]; then
  echo "refreshing font cache"
  fc-cache -vf "$font_dir"
fi

{{ end -}}
